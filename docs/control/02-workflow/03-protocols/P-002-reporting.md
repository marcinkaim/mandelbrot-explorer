<!--
  Mandelbrot Explorer
  Copyright (C) 2026 Marcin Kaim

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

# PROTOCOL: P-002 - REPORTING

## 1. Philosophy: "State Serialization"

The **Reporting** protocol is designed to solve the problem of "Context Decay" in long-running engineering tasks. While Chat Logs are ephemeral and unstructured, an **Action Report** is a persistent, structured serialization of the Agent's reasoning, execution, and verification state.

It mimics the **Lab Notebook** of a scientist or the **Flight Recorder** (Black Box) in aviation: strictly formatted data that survives the immediate session and serves as the source of truth for the entire project team (Agents & Humans).

## 2. The Report Structure

The official, executable template for this protocol is located at:
`docs/control/02-workflow/02-document-templates/template-action-report.md`

**Applicability:** This protocol is used by the **Engineer**, **DevOps**, **Auditor**, and **Tester** roles.

All Agents concluding a unit of work (Task, sub-task, or review) MUST generate a response strictly adhering to this structure.

### 2.1. The Container
The report is a standalone Markdown document. Unlike Semantic Diff (which modifies existing files), the Action Report is always a **New File Creation** event.

### 2.2. Sections
* **Metadata Header:** Critical key-value pairs (Sequence ID, Role, Outcome) used for deterministic routing and filing.
* **Executive Summary:** High-level synthesis for Manager/Architect roles.
* **Technical Body:** Role-specific deep dive (Implementation details, Audit logs, or Test telemetry).
* **Blockers:** Explicit declaration of impediments.

---

## 3. Rules of Engagement (The "Constraints")

To ensure the report acts as a valid node in the project's knowledge graph, Agents must adhere to these rules:

### Rule 1: Deterministic Metadata
The Agent does NOT choose the filename. Instead, the Agent MUST fill the **Metadata Header** accurately. The System (Tooling) will derive the filename and path from these fields.

* **Sequence ID:** Must act as a logical clock (incrementing previous ID found in the directory).
* **Role:** Must match the active Persona (e.g., ENGINEER, AUDITOR).
* **Outcome:** Must be one of: `SUCCESS`, `FAILURE`, `NEEDS_INFO`.

*Derivation Logic (for reference):*
`[SEQUENCE_ID]-[ROLE_LOWERCASE]-[OUTCOME_LOWERCASE].md`
*(e.g., `AR-02-engineer-success.md`)*

### Rule 2: Role-Specific Hygiene
The template contains sections for *all* roles. The Agent MUST **delete** sections irrelevant to their current role.
* **Bad:** An `ENGINEER` leaving empty "Validation Telemetry" sections intended for a `TESTER`.
* **Good:** An `ENGINEER` keeping only "2.1 Implementation" and removing 2.2 and 2.3.

### Rule 3: Atomic Context
The report must be self-contained. Do not rely on "as discussed above".
* If referencing code, cite specific files and commit hashes (if known).
* If referencing a decision, link to the relevant ADR or RFC.

### Rule 4: Metadata Exclusion
* **No License Headers:** Do NOT include copyright or license headers (e.g., GPL preambles) in the report content. The report is a dynamic artifact of the workflow, not source code requiring redistribution licensing headers in the body.

### Rule 5: Evidence-Based Verification
Subjective assertions are forbidden in the "Technical Details" section.
* **Forbidden:** "The code runs fast."
* **Required:** "Frame time reduced from 16ms to 4ms on RTX 3500 Ada."
* **Forbidden:** "I checked the code."
* **Required:** "Static analysis passed with `gnatprove --level=4`."

## 4. Parser Logic (Reference Implementation Guide)

The tooling handling the `Action Report` response operates as follows:

1. **Extract Content:** Capture the Markdown block generated by the Agent.
2. **Parse Metadata:** Read the bullet points in the header (Sequence ID, Role, Outcome).
3. **Resolve Path:**
    * Determine the active Task directory (context-dependent).
    * Construct filename: `{Sequence ID}-{Role}-{Outcome}.md`.
    * Target Path: `docs/control/05-tasks/02-reports/{Task ID}/{Filename}`.
4. **Write to Disk:** Save the content as a new file.
5. **Git Operations:** Automatically stage (`git add`) the new report to lock in the state change.